# Next.js + pnpm å¤šå·¥ç¨‹æ”¹é€ æŠ€æœ¯æ–¹æ¡ˆ

æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œå°†ç°æœ‰å•å·¥ç¨‹æ”¹é€ ä¸ºå¤šå·¥ç¨‹æ¶æ„ï¼Œæé«˜ä»£ç å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ—ï¸ å¤šå·¥ç¨‹æ¶æ„è®¾è®¡

### 1. æ•´ä½“æ¶æ„æ¦‚è§ˆ

```
next-ai-build-workspace/
â”œâ”€â”€ ğŸ“ packages/                        # å¯å¤ç”¨çš„åŒ…
â”‚   â”œâ”€â”€ ğŸ“ lib/                         # @next-ai-build/lib - å·¥å…·ç±»åº“
â”‚   â”œâ”€â”€ ğŸ“ base-ui/                     # @next-ai-build/base-ui - åŸºç¡€UIç»„ä»¶
â”‚   â”œâ”€â”€ ğŸ“ third-ui/                    # @next-ai-build/third-ui - ç¬¬ä¸‰æ–¹å°è£…ç»„ä»¶
â”‚   â”œâ”€â”€ ğŸ“ scripts/                     # @next-ai-build/scripts - è‡ªåŠ¨åŒ–è„šæœ¬
â”‚   â””â”€â”€ ğŸ“ configs/                     # @next-ai-build/configs - é€šç”¨é…ç½®
â”‚
â”œâ”€â”€ ğŸ“ apps/                            # åº”ç”¨ç¨‹åºç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ main-website/                # ä¸»ç½‘ç«™ (åŸé¡¹ç›®é‡æ„)
â”‚   â”œâ”€â”€ ğŸ“ docs-site/                   # æ–‡æ¡£ç½‘ç«™ (æœªæ¥æ‰©å±•)
â”‚   â””â”€â”€ ğŸ“ admin-portal/                # ç®¡ç†åå° (æœªæ¥æ‰©å±•)
â”‚
â”œâ”€â”€ ğŸ“ shared/                          # å…±äº«èµ„æº
â”‚   â”œâ”€â”€ ğŸ“ types/                       # å…±äº«ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ ğŸ“ configs/                     # å…±äº«é…ç½® (å¤æ‚/ä¸ªæ€§åŒ–é…ç½®)
â”‚   â”œâ”€â”€ ğŸ“ assets/                      # å…±äº«é™æ€èµ„æº
â”‚   â”œâ”€â”€ ğŸ“ constants/                   # å…±äº«å¸¸é‡
â”‚   â”œâ”€â”€ ğŸ“ utils/                       # å…±äº«å·¥å…·å‡½æ•° (å¤æ‚é€»è¾‘)
â”‚   â””â”€â”€ ğŸ“ hooks/                       # å…±äº« React Hooks
â”‚
â”œâ”€â”€ ğŸ“ tools/                           # å¼€å‘å·¥å…· (å¯é€‰)
â”‚   â””â”€â”€ ğŸ“ build-utils/                 # æ„å»ºå·¥å…·
â”‚
â”œâ”€â”€ package.json                        # æ ¹é…ç½®
â”œâ”€â”€ pnpm-workspace.yaml                 # pnpm workspace é…ç½®
â”œâ”€â”€ turbo.json                          # Turborepo æ„å»ºé…ç½®
â””â”€â”€ README.md                           # é¡¹ç›®è¯´æ˜
```

## ğŸ¤” å…³é”®é—®é¢˜è§£ç­”

### é—®é¢˜Aï¼šshared/assets èµ„æºè‡ªåŠ¨è§£ææœºåˆ¶

#### èµ„æºç®¡ç†å®ç°æ–¹æ¡ˆ

**æ–¹æ¡ˆï¼šç¬¦å·é“¾æ¥ + æ„å»ºè„šæœ¬ï¼ˆæ¨èï¼‰**

åœ¨æ¯ä¸ªåº”ç”¨çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨åˆ›å»ºç¬¦å·é“¾æ¥å°†å…±äº«èµ„æºæ˜ å°„åˆ°æœ¬åœ° `public/` ç›®å½•ï¼š

```typescript
// packages/scripts/src/lib/asset-manager.ts
import { promises as fs } from 'fs';
import path from 'path';

export class AssetManager {
  constructor(
    private appPath: string,
    private sharedAssetsPath: string = '../../shared/assets'
  ) {}

  async linkSharedAssets() {
    const publicDir = path.join(this.appPath, 'public');
    const sharedDir = path.resolve(this.appPath, this.sharedAssetsPath);
    
    // ç¡®ä¿ public ç›®å½•å­˜åœ¨
    await fs.mkdir(publicDir, { recursive: true });
    
    // åˆ›å»ºå…±äº«èµ„æºçš„ç¬¦å·é“¾æ¥
    const linkMappings = [
      { source: 'icons', target: 'shared/icons' },
      { source: 'images', target: 'shared/images' },
      { source: 'fonts', target: 'shared/fonts' }
    ];
    
    for (const { source, target } of linkMappings) {
      const sourcePath = path.join(sharedDir, source);
      const targetPath = path.join(publicDir, target);
      
      try {
        // æ£€æŸ¥æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨
        await fs.access(sourcePath);
        
        // åˆ›å»ºç›®æ ‡ç›®å½•
        await fs.mkdir(path.dirname(targetPath), { recursive: true });
        
        // åˆ›å»ºç¬¦å·é“¾æ¥
        await fs.symlink(path.relative(path.dirname(targetPath), sourcePath), targetPath);
        
        console.log(`âœ… Linked ${source} -> ${target}`);
      } catch (error) {
        console.warn(`âš ï¸ Failed to link ${source}:`, error);
      }
    }
  }
}
```

**CLIå‘½ä»¤é›†æˆï¼š**

```typescript
// packages/scripts/src/commands/link-assets.ts
import { AssetScanner } from '../lib/asset-scanner';
import path from 'path';

export async function linkAssetsCommand(options: { path?: string } = {}) {
  const projectPath = path.resolve(options.path || process.cwd());
  const sharedAssetsPath = path.resolve(projectPath, '../../shared/assets');
  const publicPath = path.join(projectPath, 'public');
  
  const scanner = new AssetScanner(sharedAssetsPath, publicPath);
  await scanner.scanAndLinkAssets();
}
```

**åº”ç”¨çš„ package.json è„šæœ¬é…ç½®ï¼š**

```json
{
  "scripts": {
    "prebuild": "next-ai-scripts link-assets",
    "predev": "next-ai-scripts link-assets", 
    "build": "next build",
    "dev": "next dev",
    "assets:sync": "next-ai-scripts link-assets --watch"
  }
}
```

**ç›‘å¬æ¨¡å¼æ”¯æŒï¼ˆå¼€å‘æ—¶è‡ªåŠ¨åŒæ­¥ï¼‰ï¼š**

```typescript
// packages/scripts/src/commands/watch-assets.ts
import chokidar from 'chokidar';
import { AssetScanner } from '../lib/asset-scanner';

export async function watchAssetsCommand(options: { path?: string } = {}) {
  const projectPath = path.resolve(options.path || process.cwd());
  const sharedAssetsPath = path.resolve(projectPath, '../../shared/assets');
  
  console.log('ğŸ‘€ ç›‘å¬å…±äº«èµ„æºå˜åŒ–...');
  
  const watcher = chokidar.watch(sharedAssetsPath, {
    ignored: /(^|[\/\\])\../, // å¿½ç•¥éšè—æ–‡ä»¶
    persistent: true
  });

  const scanner = new AssetScanner(sharedAssetsPath, path.join(projectPath, 'public'));

  watcher
    .on('add', async () => {
      console.log('ğŸ“ æ£€æµ‹åˆ°æ–°èµ„æºï¼Œé‡æ–°åŒæ­¥...');
      await scanner.scanAndLinkAssets();
    })
    .on('unlink', async () => {
      console.log('ğŸ—‘ï¸ æ£€æµ‹åˆ°èµ„æºåˆ é™¤ï¼Œé‡æ–°åŒæ­¥...');
      await scanner.scanAndLinkAssets();
    });
}
```

#### ä½¿ç”¨æ–¹å¼

**ç±»å‹å®‰å…¨çš„èµ„æºä½¿ç”¨ï¼š**

```tsx
// apps/main-website/src/components/Header.tsx
import Image from 'next/image';
import { SHARED_ASSETS } from '@/generated/shared-assets';

export function Header() {
  return (
    <header>
      {/* ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ç±»å‹å®‰å…¨è·¯å¾„ */}
      <Image 
        src={SHARED_ASSETS.icons.logo}  // è‡ªåŠ¨è¡¥å…¨ + ç±»å‹æ£€æŸ¥
        alt="Logo" 
        width={120} 
        height={40} 
      />
      
      {/* ä½¿ç”¨é»˜è®¤å¤´åƒ */}
      <Image 
        src={SHARED_ASSETS.images.defaultAvatar}
        alt="Default Avatar" 
        width={32} 
        height={32} 
      />
    </header>
  );
}
```

**åŠ¨æ€èµ„æºè·å–ï¼š**

```tsx
// apps/main-website/src/components/IconDisplay.tsx
import { getAssetPath } from '@/generated/shared-assets';

interface IconDisplayProps {
  iconName: string;
}

export function IconDisplay({ iconName }: IconDisplayProps) {
  const iconPath = getAssetPath('icons', iconName);
  
  if (!iconPath) {
    return <div>å›¾æ ‡æœªæ‰¾åˆ°</div>;
  }
  
  return <img src={iconPath} alt={iconName} />;
}
```

#### å®Œæ•´çš„è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹

**1. å¼€å‘è€…æ·»åŠ æ–°èµ„æºæ—¶ï¼š**

```bash
# 1. å¼€å‘è€…åœ¨ shared/assets æ·»åŠ æ–°èµ„æº
cp new-logo.svg shared/assets/icons/brand/

# 2. è„šæœ¬è‡ªåŠ¨æ£€æµ‹å˜åŒ–ï¼ˆå¦‚æœå¼€å¯äº†ç›‘å¬æ¨¡å¼ï¼‰
# æˆ–è€…æ‰‹åŠ¨è¿è¡ŒåŒæ­¥å‘½ä»¤
pnpm assets:sync

# 3. è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
# âœ… æ‰«æ shared/assets ç›®å½•
# âœ… åˆ›å»ºç¬¦å·é“¾æ¥åˆ° public/shared/
# âœ… é‡æ–°ç”Ÿæˆ src/generated/shared-assets.ts
# âœ… æ›´æ–° TypeScript ç±»å‹å®šä¹‰

# 4. å¼€å‘è€…ç«‹å³å¯ä»¥ä½¿ç”¨ç±»å‹å®‰å…¨çš„èµ„æºå¼•ç”¨
# SHARED_ASSETS.icons.newLogo (è‡ªåŠ¨è¡¥å…¨)
```

**2. ç”Ÿæˆçš„æ–‡ä»¶ç¤ºä¾‹ï¼š**

```typescript
// src/generated/shared-assets.ts (è‡ªåŠ¨ç”Ÿæˆ)
// ğŸš¨ æ­¤æ–‡ä»¶ç”±è„šæœ¬è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹
// Generated at: 2024-01-20T10:30:00.000Z

export const SHARED_ASSETS = {
  icons: {
    logo: '/shared/icons/brand/logo.svg',
    newLogo: '/shared/icons/brand/new-logo.svg',
    github: '/shared/icons/social/github.svg',
    arrow: '/shared/icons/ui/arrow.svg'
  },
  images: {
    defaultAvatar: '/shared/images/placeholders/avatar.webp',
    heroBackground: '/shared/images/backgrounds/hero-bg.webp'
  },
  fonts: {
    inter: '/shared/fonts/inter/Inter-Regular.woff2'
  }
} as const;

// ç±»å‹æ¨å¯¼å’Œè¾…åŠ©å‡½æ•°...
```

**3. ç›®å½•ç»“æ„æ˜ å°„ï¼š**

```
shared/assets/                          public/shared/ (ç¬¦å·é“¾æ¥)
â”œâ”€â”€ icons/                          â†’   â”œâ”€â”€ icons/ -> ../../shared/assets/icons/
â”‚   â”œâ”€â”€ brand/                      â†’   â”‚   â”œâ”€â”€ brand/
â”‚   â”‚   â”œâ”€â”€ logo.svg               â†’   â”‚   â”‚   â”œâ”€â”€ logo.svg
â”‚   â”‚   â””â”€â”€ favicon.ico            â†’   â”‚   â”‚   â””â”€â”€ favicon.ico
â”‚   â”œâ”€â”€ social/                     â†’   â”‚   â””â”€â”€ social/
â”‚   â”‚   â””â”€â”€ github.svg             â†’   â”‚       â””â”€â”€ github.svg
â”‚   â””â”€â”€ ui/                         â†’   â””â”€â”€ ui/
â”‚       â””â”€â”€ arrow.svg              â†’       â””â”€â”€ arrow.svg
â”œâ”€â”€ images/                         â†’   â”œâ”€â”€ images/ -> ../../shared/assets/images/
â”‚   â””â”€â”€ placeholders/               â†’   â”‚   â””â”€â”€ placeholders/
â”‚       â””â”€â”€ avatar.webp            â†’   â”‚       â””â”€â”€ avatar.webp
â””â”€â”€ fonts/                          â†’   â””â”€â”€ fonts/ -> ../../shared/assets/fonts/
    â””â”€â”€ inter/                      â†’       â””â”€â”€ inter/
        â””â”€â”€ Inter-Regular.woff2     â†’           â””â”€â”€ Inter-Regular.woff2
```

**4. CLI å‘½ä»¤æ‰©å±•ï¼š**

```bash
# åŸºæœ¬åŒæ­¥
pnpm next-ai-scripts link-assets

# ç›‘å¬æ¨¡å¼ï¼ˆå¼€å‘æ—¶ï¼‰
pnpm next-ai-scripts link-assets --watch

# å¼ºåˆ¶é‡æ–°ç”Ÿæˆï¼ˆæ¸…ç†å¹¶é‡å»ºæ‰€æœ‰é“¾æ¥ï¼‰
pnpm next-ai-scripts link-assets --force

# åªç”Ÿæˆç±»å‹æ–‡ä»¶ï¼Œä¸åˆ›å»ºé“¾æ¥
pnpm next-ai-scripts generate-asset-types

# æ£€æŸ¥é“¾æ¥å®Œæ•´æ€§
pnpm next-ai-scripts check-assets
```

**è‡ªåŠ¨èµ„æºè·¯å¾„æ˜ å°„ï¼š**

```typescript
// packages/scripts/src/lib/asset-scanner.ts
import { promises as fs } from 'fs';
import path from 'path';
import { glob } from 'fast-glob';

export class AssetScanner {
  constructor(
    private sharedAssetsPath: string,
    private publicPath: string
  ) {}

  /**
   * è‡ªåŠ¨æ‰«æ shared/assets ç›®å½•å¹¶åˆ›å»ºç¬¦å·é“¾æ¥
   */
  async scanAndLinkAssets() {
    console.log('ğŸ” æ‰«æå…±äº«èµ„æº...');
    
    // æ‰«ææ‰€æœ‰èµ„æºæ–‡ä»¶
    const assetFiles = await glob('**/*', {
      cwd: this.sharedAssetsPath,
      onlyFiles: true,
      dot: false
    });

    // è·å–æ‰€æœ‰ç›®å½•ç»“æ„
    const directories = new Set<string>();
    assetFiles.forEach(file => {
      const dir = path.dirname(file);
      if (dir !== '.') {
        directories.add(dir);
      }
    });

    // åˆ›å»ºç›®å½•ç»“æ„çš„ç¬¦å·é“¾æ¥ (æ¨èæ–¹å¼)
    await this.linkDirectories(directories);

    console.log(`âœ… é“¾æ¥äº† ${directories.size} ä¸ªèµ„æºç›®å½•ï¼ŒåŒ…å« ${assetFiles.length} ä¸ªæ–‡ä»¶`);
    
    // ç”Ÿæˆç±»å‹å®‰å…¨çš„èµ„æºæ˜ å°„
    await this.generateAssetMap(assetFiles);
  }

  /**
   * åˆ›å»ºç›®å½•çº§åˆ«çš„ç¬¦å·é“¾æ¥ (æ€§èƒ½æ›´å¥½)
   */
  private async linkDirectories(directories: Set<string>) {
    const sharedPublicPath = path.join(this.publicPath, 'shared');
    
    // ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨
    await fs.mkdir(sharedPublicPath, { recursive: true });

    for (const dir of directories) {
      const sourcePath = path.join(this.sharedAssetsPath, dir);
      const targetPath = path.join(sharedPublicPath, dir);
      
      try {
        // æ£€æŸ¥æºç›®å½•æ˜¯å¦å­˜åœ¨
        await fs.access(sourcePath);
        
        // åˆ›å»ºçˆ¶ç›®å½•
        await fs.mkdir(path.dirname(targetPath), { recursive: true });
        
        // åˆ›å»ºç¬¦å·é“¾æ¥ (ç›¸å¯¹è·¯å¾„)
        const relativePath = path.relative(path.dirname(targetPath), sourcePath);
        await fs.symlink(relativePath, targetPath, 'dir');
        
        console.log(`ğŸ“ ${dir} -> /shared/${dir}`);
      } catch (error) {
        // å¦‚æœç¬¦å·é“¾æ¥å·²å­˜åœ¨æˆ–å…¶ä»–é”™è¯¯ï¼Œè·³è¿‡
        if ((error as any).code !== 'EEXIST') {
          console.warn(`âš ï¸ æ— æ³•é“¾æ¥ç›®å½• ${dir}:`, error);
        }
      }
    }
  }

  /**
   * è‡ªåŠ¨ç”Ÿæˆç±»å‹å®‰å…¨çš„èµ„æºæ˜ å°„æ–‡ä»¶
   */
  private async generateAssetMap(assetFiles: string[]) {
    const assetMap: Record<string, Record<string, string>> = {};
    
    // æŒ‰ç›®å½•åˆ†ç»„
    for (const file of assetFiles) {
      const dir = path.dirname(file);
      const filename = path.basename(file, path.extname(file));
      const webPath = `/shared/${file}`;
      
      if (!assetMap[dir]) {
        assetMap[dir] = {};
      }
      
      // ä½¿ç”¨ camelCase ä½œä¸ºé”®å
      const key = filename.replace(/[-_]/g, ' ')
        .replace(/\w\S*/g, (txt) => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase())
        .replace(/\s/g, '');
      
      assetMap[dir][key.charAt(0).toLowerCase() + key.slice(1)] = webPath;
    }

    // ç”Ÿæˆ TypeScript æ–‡ä»¶
    const typeContent = this.generateAssetTypes(assetMap);
    const outputPath = path.join(this.publicPath, '../src/generated/shared-assets.ts');
    
    await fs.mkdir(path.dirname(outputPath), { recursive: true });
    await fs.writeFile(outputPath, typeContent, 'utf-8');
    
    console.log('ğŸ“ å·²ç”Ÿæˆèµ„æºæ˜ å°„: src/generated/shared-assets.ts');
  }

  private generateAssetTypes(assetMap: Record<string, Record<string, string>>): string {
    const entries = Object.entries(assetMap).map(([dir, files]) => {
      const fileEntries = Object.entries(files)
        .map(([key, path]) => `    ${key}: '${path}'`)
        .join(',\n');
      
      return `  ${dir.replace(/[^a-zA-Z0-9]/g, '_')}: {\n${fileEntries}\n  }`;
    }).join(',\n');

    return `// ğŸš¨ æ­¤æ–‡ä»¶ç”±è„šæœ¬è‡ªåŠ¨ç”Ÿæˆï¼Œè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹
// Generated at: ${new Date().toISOString()}

export const SHARED_ASSETS = {
${entries}
} as const;

// ç±»å‹æ¨å¯¼
export type SharedAssets = typeof SHARED_ASSETS;

// è¾…åŠ©å‡½æ•°ï¼šè·å–èµ„æºè·¯å¾„
export function getAssetPath(category: keyof SharedAssets, asset: string): string | undefined {
  return (SHARED_ASSETS[category] as any)?.[asset];
}

// ä½¿ç”¨ç¤ºä¾‹:
// import { SHARED_ASSETS, getAssetPath } from '@/generated/shared-assets';
// const logoPath = SHARED_ASSETS.icons.logo;
// const avatarPath = getAssetPath('images', 'defaultAvatar');
`;
  }
}
```

### é—®é¢˜Bï¼šé…ç½®ä¼˜å…ˆçº§å’Œè¦†ç›–ç­–ç•¥

#### é…ç½®ä¼˜å…ˆçº§å±‚æ¬¡

é…ç½®çš„ä¼˜å…ˆçº§ä»é«˜åˆ°ä½å¦‚ä¸‹ï¼š

```
åº”ç”¨é…ç½® (apps/*/next.config.ts) 
    â†“ è¦†ç›–
å…±äº«ä¸ªæ€§åŒ–é…ç½® (shared/configs/*) 
    â†“ è¦†ç›–  
åŸºç¡€é€šç”¨é…ç½® (packages/configs/*)
```

#### å®ç°é…ç½®åˆå¹¶ç­–ç•¥

**1. åŸºç¡€é…ç½®å±‚ (packages/configs/)**

```typescript
// packages/configs/src/next/base.config.ts
import type { NextConfig } from 'next';

export const baseNextConfig: Partial<NextConfig> = {
  reactStrictMode: true,
  swcMinify: true,
  
  images: {
    formats: ['image/webp', 'image/avif'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
  },
  
  experimental: {
    optimizePackageImports: ['@next-ai-build/base-ui'],
  },
  
  // åŸºç¡€çš„ç¯å¢ƒå˜é‡
  env: {
    NEXT_PUBLIC_APP_ENV: process.env.NODE_ENV || 'development'
  }
};
```

**2. å…±äº«é…ç½®å±‚ (shared/configs/)**

```typescript
// shared/configs/deployment/vercel/next-config.ts
import type { NextConfig } from 'next';
import { baseNextConfig } from '@next-ai-build/configs/next';

export function createVercelConfig(overrides: Partial<NextConfig> = {}): NextConfig {
  return {
    ...baseNextConfig,
    
    // Vercel ç‰¹å®šé…ç½®
    images: {
      ...baseNextConfig.images,
      domains: ['cdn.example.com', 'assets.vercel.com'],
      // å…è®¸åº”ç”¨è¦†ç›– domains
      ...overrides.images
    },
    
    // Vercel ç¯å¢ƒå˜é‡
    env: {
      ...baseNextConfig.env,
      NEXT_PUBLIC_DEPLOYMENT_PLATFORM: 'vercel',
      ...overrides.env
    },
    
    // å…è®¸åº”ç”¨è¦†ç›–å…¶ä»–é…ç½®
    ...overrides
  };
}
```

**3. åº”ç”¨é…ç½®å±‚ (apps/*/next.config.ts)**

```typescript
// apps/main-website/next.config.ts
import { createVercelConfig } from '@shared/configs/deployment/vercel/next-config';
import { createMDX } from 'fumadocs-mdx/next';
import createNextIntlPlugin from 'next-intl/plugin';

const withNextIntl = createNextIntlPlugin('./src/i18n.ts');
const withMDX = createMDX();

// åº”ç”¨ç‰¹å®šçš„é…ç½®è¦†ç›–
const appConfig = createVercelConfig({
  // è¦†ç›–å›¾ç‰‡åŸŸåï¼Œæ·»åŠ åº”ç”¨ç‰¹å®šçš„åŸŸå
  images: {
    domains: ['cdn.example.com', 'assets.vercel.com', 'my-app-cdn.com'],
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'favicon.im',
      }
    ]
  },
  
  // åº”ç”¨ç‰¹å®šçš„ç¯å¢ƒå˜é‡
  env: {
    NEXT_PUBLIC_APP_NAME: 'Main Website',
    NEXT_PUBLIC_API_BASE_URL: process.env.API_BASE_URL || 'https://api.example.com'
  },
  
  // åº”ç”¨ç‰¹å®šçš„å®éªŒæ€§åŠŸèƒ½
  experimental: {
    webpackBuildWorker: true,
    parallelServerBuildTraces: true,
  },
  
  // åº”ç”¨ç‰¹å®šçš„é‡å†™è§„åˆ™
  async rewrites() {
    return [
      {
        source: '/shared/:path*',
        destination: '/../../shared/assets/:path*'
      }
    ];
  }
});

export default withNextIntl(withMDX(appConfig));
```

#### é…ç½®åˆå¹¶å·¥å…·

```typescript
// packages/lib/src/config/config-merger.ts
import { deepMerge } from '../utils/deep-merge';

export function mergeConfigs<T extends Record<string, any>>(
  base: T,
  shared: Partial<T>,
  app: Partial<T>
): T {
  // æ·±åº¦åˆå¹¶é…ç½®ï¼Œåè€…è¦†ç›–å‰è€…
  return deepMerge(deepMerge(base, shared), app);
}

// ç‰¹æ®Šæ•°ç»„åˆå¹¶ç­–ç•¥ï¼ˆå¦‚ images.domainsï¼‰
export function mergeArrayConfigs<T>(
  base: T[] = [],
  shared: T[] = [],
  app: T[] = []
): T[] {
  // å»é‡åˆå¹¶æ•°ç»„
  return [...new Set([...base, ...shared, ...app])];
}
```

#### é…ç½®éªŒè¯æœºåˆ¶

```typescript
// packages/lib/src/config/config-validator.ts
import { z } from 'zod';

const NextConfigSchema = z.object({
  reactStrictMode: z.boolean().optional(),
  images: z.object({
    domains: z.array(z.string()).optional(),
    formats: z.array(z.string()).optional(),
  }).optional(),
  env: z.record(z.string()).optional(),
});

export function validateConfig(config: unknown) {
  try {
    return NextConfigSchema.parse(config);
  } catch (error) {
    console.error('âŒ Invalid Next.js configuration:', error);
    throw error;
  }
}
```

### é—®é¢˜1ï¼šscripts åŒ…çš„æ„å»ºã€å‘å¸ƒå’Œä½¿ç”¨æ–¹å¼

#### åŒ…ç»“æ„è®¾è®¡

```
packages/scripts/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                       # å¯¼å‡ºæ‰€æœ‰åŠŸèƒ½
â”‚   â”œâ”€â”€ cli/
â”‚   â”‚   â”œâ”€â”€ index.ts                   # CLI ä¸»å…¥å£
â”‚   â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”‚   â”œâ”€â”€ check-translations.ts  # ç¿»è¯‘æ£€æŸ¥å‘½ä»¤
â”‚   â”‚   â”‚   â”œâ”€â”€ clean-translations.ts  # ç¿»è¯‘æ¸…ç†å‘½ä»¤
â”‚   â”‚   â”‚   â”œâ”€â”€ generate-blog.ts       # åšå®¢ç”Ÿæˆå‘½ä»¤
â”‚   â”‚   â”‚   â””â”€â”€ init-project.ts        # æ–°é¡¹ç›®åˆå§‹åŒ–
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ cli-utils.ts
â”‚   â”œâ”€â”€ lib/                          # å¯ç¼–ç¨‹è°ƒç”¨çš„API
â”‚   â”‚   â”œâ”€â”€ translation-checker.ts    # ç¿»è¯‘æ£€æŸ¥å™¨ç±»
â”‚   â”‚   â”œâ”€â”€ blog-generator.ts         # åšå®¢ç”Ÿæˆå™¨ç±»
â”‚   â”‚   â””â”€â”€ project-initializer.ts    # é¡¹ç›®åˆå§‹åŒ–å™¨ç±»
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ next-ai-scripts.js            # CLI å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ templates/                        # æ¨¡æ¿æ–‡ä»¶
â”‚   â”œâ”€â”€ project/
â”‚   â”‚   â”œâ”€â”€ package.json.template
â”‚   â”‚   â”œâ”€â”€ next.config.template.ts
â”‚   â”‚   â””â”€â”€ tsconfig.template.json
â”‚   â”œâ”€â”€ blog/
â”‚   â”‚   â””â”€â”€ article.template.mdx
â”‚   â””â”€â”€ i18n/
â”‚       â”œâ”€â”€ en.template.json
â”‚       â””â”€â”€ zh.template.json
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ README.md
â””â”€â”€ CHANGELOG.md
```

#### package.json é…ç½®

```json
{
  "name": "@next-ai-build/scripts",
  "version": "1.0.0",
  "description": "Automation scripts for Next.js AI Build projects",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "bin": {
    "next-ai-scripts": "./bin/next-ai-scripts.js",
    "nai": "./bin/next-ai-scripts.js"
  },
  "files": [
    "dist",
    "bin",
    "templates"
  ],
  "scripts": {
    "build": "tsup src/index.ts src/cli/index.ts --format cjs,esm --dts --clean",
    "dev": "tsup src/index.ts src/cli/index.ts --format cjs,esm --dts --watch",
    "prepublishOnly": "pnpm build"
  },
  "dependencies": {
    "@next-ai-build/lib": "workspace:*",
    "commander": "^11.0.0",
    "inquirer": "^9.0.0",
    "chalk": "^5.0.0",
    "fast-glob": "^3.3.0"
  },
  "devDependencies": {
    "tsup": "^8.0.0"
  }
}
```

#### CLI å…¥å£æ–‡ä»¶ (bin/next-ai-scripts.js)

```javascript
#!/usr/bin/env node

const { program } = require('commander');
const { checkTranslations, cleanTranslations, generateBlog, initProject } = require('../dist/cli/index.js');

program
  .name('next-ai-scripts')
  .description('Automation scripts for Next.js AI Build projects')
  .version(require('../package.json').version);

program
  .command('check-translations')
  .description('Check translation files for missing keys')
  .option('-p, --path <path>', 'Project path', process.cwd())
  .action(checkTranslations);

program
  .command('clean-translations')
  .description('Clean unused translation keys')
  .option('-p, --path <path>', 'Project path', process.cwd())
  .option('--remove', 'Actually remove unused keys')
  .action(cleanTranslations);

program
  .command('generate-blog')
  .description('Generate blog index')
  .option('-p, --path <path>', 'Project path', process.cwd())
  .action(generateBlog);

program
  .command('init')
  .description('Initialize a new Next.js AI Build project')
  .option('-t, --template <template>', 'Template type', 'basic')
  .action(initProject);

program.parse();
```

#### ä½¿ç”¨æ–¹å¼

**1. ä½œä¸ºä¾èµ–å®‰è£…ï¼š**
```bash
# åœ¨æ–°é¡¹ç›®ä¸­å®‰è£…
pnpm add -D @next-ai-build/scripts

# package.json scripts ä¸­ä½¿ç”¨
{
  "scripts": {
    "check-translations": "next-ai-scripts check-translations",
    "clean-translations": "next-ai-scripts clean-translations --remove",
    "generate-blog": "next-ai-scripts generate-blog"
  }
}
```

**2. å…¨å±€å®‰è£…ï¼š**
```bash
# å…¨å±€å®‰è£…
npm install -g @next-ai-build/scripts

# ç›´æ¥ä½¿ç”¨
next-ai-scripts init my-new-site
nai check-translations
```

**3. ç¼–ç¨‹æ–¹å¼è°ƒç”¨ï¼š**
```typescript
import { TranslationChecker, BlogGenerator } from '@next-ai-build/scripts';

const checker = new TranslationChecker({
  projectPath: './my-project',
  locales: ['en', 'zh']
});

const result = await checker.check();
```

### é—®é¢˜2ï¼šä½¿ç”¨ apps/ ç›®å½•å¹¶æ”¯æŒå¤šç½‘ç«™éƒ¨ç½²

#### apps ç›®å½•ç»“æ„

```
apps/
â”œâ”€â”€ ğŸ“ main-website/                   # ä¸»ç½‘ç«™
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ next.config.ts
â”‚   â”œâ”€â”€ vercel.json                    # Vercel éƒ¨ç½²é…ç½®
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ ğŸ“ docs-site/                      # æ–‡æ¡£ç½‘ç«™
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ next.config.ts
â”‚   â”œâ”€â”€ vercel.json
â”‚   â””â”€â”€ README.md
â”‚
â””â”€â”€ ğŸ“ admin-portal/                   # ç®¡ç†åå°
    â”œâ”€â”€ src/
    â”œâ”€â”€ package.json
    â”œâ”€â”€ next.config.ts
    â”œâ”€â”€ vercel.json
    â””â”€â”€ README.md
```

#### éƒ¨ç½²é…ç½®

**æ¯ä¸ªåº”ç”¨çš„ vercel.jsonï¼š**
```json
{
  "buildCommand": "cd ../.. && pnpm build --filter=main-website",
  "outputDirectory": ".next",
  "installCommand": "cd ../.. && pnpm install",
  "ignoreCommand": "cd ../.. && pnpm dlx turbo-ignore main-website"
}
```

**Turborepo é…ç½®æ”¯æŒå¤šåº”ç”¨ï¼š**
```json
{
  "$schema": "https://turbo.build/schema.json",
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": [".next/**", "!.next/cache/**", "dist/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    },
    "main-website#build": {
      "dependsOn": ["@next-ai-build/lib#build", "@next-ai-build/base-ui#build", "@next-ai-build/third-ui#build"],
      "outputs": [".next/**", "!.next/cache/**"]
    },
    "docs-site#build": {
      "dependsOn": ["@next-ai-build/lib#build", "@next-ai-build/base-ui#build"],
      "outputs": [".next/**", "!.next/cache/**"]
    }
  }
}
```

#### æ·»åŠ æ–°ç½‘ç«™çš„æµç¨‹

**1. ä½¿ç”¨è„šæœ¬åˆå§‹åŒ–ï¼š**
```bash
# ä½¿ç”¨æˆ‘ä»¬çš„è„šæœ¬å·¥å…·
pnpm next-ai-scripts init --template=docs-site apps/new-docs-site
```

**2. æ‰‹åŠ¨åˆ›å»ºï¼š**
```bash
# åˆ›å»ºæ–°åº”ç”¨ç›®å½•
mkdir apps/new-site
cd apps/new-site

# åˆå§‹åŒ– package.json
pnpm init

# å®‰è£…ä¾èµ–
pnpm add next react react-dom
pnpm add -D @next-ai-build/lib @next-ai-build/base-ui @next-ai-build/third-ui
```

**3. é…ç½®éƒ¨ç½²ï¼š**
```bash
# Vercel éƒ¨ç½²
vercel --cwd apps/new-site

# Cloudflare Pages
# åœ¨ Cloudflare æ§åˆ¶å°é…ç½®ï¼š
# Build command: cd ../.. && pnpm build --filter=new-site
# Build output directory: apps/new-site/.next
```

### é—®é¢˜3ï¼šshared ç›®å½•çš„å®Œæ•´è§„åˆ’

#### æ‰©å±•åçš„ shared ç»“æ„

```
shared/
â”œâ”€â”€ ğŸ“ types/                          # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ common.ts                      # é€šç”¨ç±»å‹
â”‚   â”œâ”€â”€ api.ts                         # API ç±»å‹
â”‚   â”œâ”€â”€ ui.ts                          # UI ç»„ä»¶ç±»å‹
â”‚   â”œâ”€â”€ i18n.ts                        # å›½é™…åŒ–ç±»å‹
â”‚   â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ ğŸ“ configs/                        # å¤æ‚/ä¸ªæ€§åŒ–é…ç½®
â”‚   â”œâ”€â”€ deployment/                    # éƒ¨ç½²é…ç½®
â”‚   â”‚   â”œâ”€â”€ vercel/
â”‚   â”‚   â”‚   â”œâ”€â”€ edge-config.ts         # Vercel Edge é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ middleware-config.ts   # ä¸­é—´ä»¶é…ç½®
â”‚   â”‚   â”œâ”€â”€ cloudflare/
â”‚   â”‚   â”‚   â”œâ”€â”€ wrangler.template.toml
â”‚   â”‚   â”‚   â””â”€â”€ workers-config.ts
â”‚   â”‚   â””â”€â”€ docker/
â”‚   â”‚       â”œâ”€â”€ Dockerfile.template
â”‚   â”‚       â””â”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ database/                      # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”‚   â”œâ”€â”€ base.schema.prisma
â”‚   â”‚   â”‚   â””â”€â”€ migrations-config.ts
â”‚   â”‚   â””â”€â”€ drizzle/
â”‚   â”‚       â””â”€â”€ base-config.ts
â”‚   â”œâ”€â”€ analytics/                     # åˆ†æå·¥å…·é…ç½®
â”‚   â”‚   â”œâ”€â”€ google-analytics.ts
â”‚   â”‚   â”œâ”€â”€ microsoft-clarity.ts
â”‚   â”‚   â””â”€â”€ posthog.ts
â”‚   â”œâ”€â”€ auth/                          # è®¤è¯é…ç½®
â”‚   â”‚   â”œâ”€â”€ clerk/
â”‚   â”‚   â”‚   â”œâ”€â”€ theme-config.ts
â”‚   â”‚   â”‚   â””â”€â”€ organization-config.ts
â”‚   â”‚   â””â”€â”€ auth0/
â”‚   â”‚       â””â”€â”€ config.ts
â”‚   â””â”€â”€ monitoring/                    # ç›‘æ§é…ç½®
â”‚       â”œâ”€â”€ sentry.config.ts
â”‚       â””â”€â”€ error-tracking.ts
â”‚
â”œâ”€â”€ ğŸ“ assets/                         # å…±äº«é™æ€èµ„æº
â”‚   â”œâ”€â”€ icons/                         # é€šç”¨å›¾æ ‡
â”‚   â”‚   â”œâ”€â”€ brand/
â”‚   â”‚   â”‚   â”œâ”€â”€ logo.svg
â”‚   â”‚   â”‚   â””â”€â”€ favicon.ico
â”‚   â”‚   â”œâ”€â”€ social/
â”‚   â”‚   â”‚   â”œâ”€â”€ github.svg
â”‚   â”‚   â”‚   â””â”€â”€ twitter.svg
â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚       â”œâ”€â”€ arrow.svg
â”‚   â”‚       â””â”€â”€ check.svg
â”‚   â”œâ”€â”€ images/                        # é€šç”¨å›¾ç‰‡
â”‚   â”‚   â”œâ”€â”€ placeholders/
â”‚   â”‚   â”‚   â”œâ”€â”€ avatar.webp
â”‚   â”‚   â”‚   â””â”€â”€ default.webp
â”‚   â”‚   â””â”€â”€ backgrounds/
â”‚   â”‚       â”œâ”€â”€ hero-bg.webp
â”‚   â”‚       â””â”€â”€ pattern.svg
â”‚   â””â”€â”€ fonts/                         # å­—ä½“æ–‡ä»¶
â”‚       â””â”€â”€ inter/
â”‚           â”œâ”€â”€ Inter-Regular.woff2
â”‚           â””â”€â”€ Inter-Bold.woff2
â”‚
â”œâ”€â”€ ğŸ“ constants/                      # å…±äº«å¸¸é‡
â”‚   â”œâ”€â”€ api-endpoints.ts               # API ç«¯ç‚¹
â”‚   â”œâ”€â”€ ui-constants.ts                # UI å¸¸é‡
â”‚   â”œâ”€â”€ feature-flags.ts               # åŠŸèƒ½å¼€å…³
â”‚   â””â”€â”€ environment.ts                 # ç¯å¢ƒå˜é‡å®šä¹‰
â”‚
â”œâ”€â”€ ğŸ“ utils/                          # å…±äº«å·¥å…·å‡½æ•° (å¤æ‚é€»è¾‘)
â”‚   â”œâ”€â”€ validation/                    # éªŒè¯å·¥å…·
â”‚   â”‚   â”œâ”€â”€ schemas.ts
â”‚   â”‚   â””â”€â”€ validators.ts
â”‚   â”œâ”€â”€ security/                      # å®‰å…¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ encryption.ts
â”‚   â”‚   â””â”€â”€ sanitization.ts
â”‚   â””â”€â”€ performance/                   # æ€§èƒ½å·¥å…·
â”‚       â”œâ”€â”€ cache.ts
â”‚       â””â”€â”€ optimization.ts
â”‚
â””â”€â”€ ğŸ“ hooks/                          # å…±äº« React Hooks
    â”œâ”€â”€ useFeatureFlag.ts
    â”œâ”€â”€ useAnalytics.ts
    â””â”€â”€ useAuth.ts
```

#### shared vs packages/configs ä½¿ç”¨åŸåˆ™

| ç±»å‹ | å­˜æ”¾ä½ç½® | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|------|----------|----------|------|
| **ç®€å•ã€é€šç”¨é…ç½®** | `packages/configs/` | å¯ç›´æ¥å¤ç”¨çš„æ ‡å‡†é…ç½® | `tsconfig.base.json`, `eslint.config.js` |
| **å¤æ‚ã€ä¸ªæ€§åŒ–é…ç½®** | `shared/configs/` | éœ€è¦å®šåˆ¶æˆ–ä¾èµ–è¾ƒå¤šçš„é…ç½® | Clerk ä¸»é¢˜é…ç½®ã€Vercel Edge é…ç½® |
| **åº”ç”¨ç‰¹å®šé…ç½®** | `apps/*/` | æ¯ä¸ªåº”ç”¨ç‹¬æœ‰çš„é…ç½® | ç‰¹å®šçš„ `next.config.ts` |

#### å®é™…ä½¿ç”¨ç¤ºä¾‹

```typescript
// shared/configs/auth/clerk/theme-config.ts
import { Appearance } from '@clerk/types';
import { brandColors } from '../../constants/ui-constants';

export const createClerkAppearance = (isDark: boolean): Appearance => ({
  baseTheme: isDark ? 'dark' : 'light',
  variables: {
    colorPrimary: brandColors.primary,
    colorBackground: isDark ? brandColors.dark.background : brandColors.light.background,
    // å¤æ‚çš„ä¸»é¢˜é…ç½®é€»è¾‘...
  },
  elements: {
    // å¤æ‚çš„å…ƒç´ æ ·å¼é…ç½®...
  }
});
```

```typescript
// apps/main-website/src/lib/auth-config.ts
import { createClerkAppearance } from '@shared/configs/auth/clerk/theme-config';
import { useTheme } from 'next-themes';

export function useClerkConfig() {
  const { theme } = useTheme();
  return {
    appearance: createClerkAppearance(theme === 'dark'),
    // åº”ç”¨ç‰¹å®šçš„ Clerk é…ç½®
  };
}
```

## ğŸ“¦ è¯¦ç»†åŒ…åˆ’åˆ†æ–¹æ¡ˆ

### 2.1 ğŸ“¦ `@next-ai-build/lib` - å·¥å…·ç±»åº“

**ç›®æ ‡**: æä¾›é€šç”¨çš„å·¥å…·å‡½æ•°å’Œé…ç½®ï¼Œå¯ç‹¬ç«‹å‘å¸ƒåˆ° npm

```
packages/lib/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                        # ä¸»å¯¼å‡ºæ–‡ä»¶
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ app-config.ts              # åŸ appConfig.ts (é€šç”¨åŒ–)
â”‚   â”‚   â”œâ”€â”€ i18n-config.ts             # å›½é™…åŒ–é…ç½®å·¥å…·
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ utils.ts                   # åŸ utils.ts
â”‚   â”‚   â”œâ”€â”€ icons.ts                   # åŸ limited-lucide-icons.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ common.ts                  # é€šç”¨ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ i18n.ts                    # å›½é™…åŒ–ç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ constants/
â”‚       â”œâ”€â”€ defaults.ts                # é»˜è®¤é…ç½®å¸¸é‡
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ README.md
â””â”€â”€ CHANGELOG.md
```

### 2.2 ğŸ¨ `@next-ai-build/base-ui` - åŸºç¡€UIç»„ä»¶

**ç›®æ ‡**: åŸºäºæˆç†Ÿæ¡†æ¶å°è£…çš„é€šç”¨UIç»„ä»¶

```
packages/base-ui/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                        # ä¸»å¯¼å‡º
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                        # åŸ shadcn/ui ç»„ä»¶ (ä¼˜åŒ–ç‰ˆ)
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ hero.tsx               # åŸ hero.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ features.tsx           # åŸ features.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ footer.tsx             # åŸ footer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ cta.tsx                # åŸ cta.tsx
â”‚   â”‚   â”‚   â””â”€â”€ gallery.tsx            # åŸ gallery.tsx
â”‚   â”‚   â”œâ”€â”€ navigation/
â”‚   â”‚   â”‚   â”œâ”€â”€ toc.tsx                # åŸ toc.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ toc-base.tsx           # åŸ toc-base.tsx
â”‚   â”‚   â”‚   â””â”€â”€ go-to-top.tsx          # åŸ go-to-top.tsx
â”‚   â”‚   â”œâ”€â”€ content/
â”‚   â”‚   â”‚   â”œâ”€â”€ tips.tsx               # åŸ tips.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ seo-content.tsx        # åŸ seo-content.tsx
â”‚   â”‚   â”‚   â””â”€â”€ 404-page.tsx           # åŸ 404-page.tsx
â”‚   â”‚   â””â”€â”€ icons/
â”‚   â”‚       â””â”€â”€ global-icon.tsx        # åŸ global-icon.tsx
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ globals.css                # åŸºç¡€æ ·å¼
â”‚   â”‚   â””â”€â”€ components.css             # ç»„ä»¶æ ·å¼
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ index.ts                   # é€šç”¨ hooks
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ cn.ts                      # className å·¥å…·
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.js                 # Tailwind é…ç½®
â”œâ”€â”€ README.md
â””â”€â”€ stories/                           # Storybook æ–‡æ¡£ (å¯é€‰)
```

### 2.3 ğŸ”Œ `@next-ai-build/third-ui` - ç¬¬ä¸‰æ–¹å°è£…ç»„ä»¶

**ç›®æ ‡**: å¯¹ç¬¬ä¸‰æ–¹æœåŠ¡å’Œå·¥å…·çš„å°è£…ç»„ä»¶

```
packages/third-ui/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ clerk/                         # Clerk è®¤è¯ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ClerkProviderClient.tsx  # åŸç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ClerkUser.tsx            # åŸç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ClerkOrganization.tsx    # åŸç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”œâ”€â”€ clerk-intl.ts            # åŸ clerk-intl.ts
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ fumadocs/                      # Fumadocs ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ fuma-banner-suit.tsx     # åŸç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ mdx/                     # åŸ mdx ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ airticalCard.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ gradient-button.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ image-zoom.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ imageGrid.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ mermaid.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ trophyCard.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ zia-card.tsx
â”‚   â”‚   â”‚   â””â”€â”€ mdx-components.tsx       # åŸ mdx-components.tsx
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”œâ”€â”€ source-config.ts         # åŸ source.config.ts æ¨¡æ¿
â”‚   â”‚   â”‚   â””â”€â”€ fuma-search-util.ts      # åŸæ–‡ä»¶
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ get-llm-text.ts          # åŸæ–‡ä»¶
â”‚   â”œâ”€â”€ analytics/                     # åˆ†æå·¥å…·ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ GoogleAnalyticsScript.tsx   # åŸæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ MicrosoftClarityScript.tsx   # åŸæ–‡ä»¶
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ i18n/                          # å›½é™…åŒ–ç»„ä»¶
â”‚       â”œâ”€â”€ LanguageDetector.tsx         # åŸæ–‡ä»¶
â”‚       â”œâ”€â”€ LanguageSwitcher.tsx         # åŸæ–‡ä»¶
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

### 2.4 âš™ï¸ `@next-ai-build/configs` - é€šç”¨é…ç½®

**ç›®æ ‡**: å¯å¤ç”¨çš„é…ç½®æ–‡ä»¶å’Œæ¨¡æ¿

```
packages/configs/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ next/
â”‚   â”‚   â”œâ”€â”€ next.config.template.ts    # Next.js é…ç½®æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ typescript/
â”‚   â”‚   â”œâ”€â”€ tsconfig.base.json         # åŸºç¡€ TS é…ç½®
â”‚   â”‚   â”œâ”€â”€ tsconfig.web.json          # Web é¡¹ç›®é…ç½®
â”‚   â”‚   â”œâ”€â”€ tsconfig.lib.json          # åº“é¡¹ç›®é…ç½®
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ eslint/
â”‚   â”‚   â”œâ”€â”€ base.js                    # åŸºç¡€ ESLint é…ç½®
â”‚   â”‚   â”œâ”€â”€ next.js                    # Next.js ESLint é…ç½®
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ tailwind/
â”‚   â”‚   â”œâ”€â”€ base.config.js             # åŸºç¡€ Tailwind é…ç½®
â”‚   â”‚   â”œâ”€â”€ components.config.js       # ç»„ä»¶ Tailwind é…ç½®
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ postcss/
â”‚   â”‚   â”œâ”€â”€ postcss.config.template.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ pnpm/
â”‚       â”œâ”€â”€ pnpmfile.js                # pnpm é…ç½®
â”‚       â””â”€â”€ index.js
â”œâ”€â”€ templates/                         # é¡¹ç›®æ¨¡æ¿
â”‚   â”œâ”€â”€ package.json.template
â”‚   â”œâ”€â”€ README.template.md
â”‚   â””â”€â”€ gitignore.template
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## âš™ï¸ æ ¸å¿ƒé…ç½®æ–‡ä»¶

### æ ¹ç›®å½• pnpm-workspace.yaml

```yaml
packages:
  - 'packages/*'
  - 'apps/*'
  - 'shared/*'
  - 'tools/*'

# å¯é€‰ï¼šæŒ‡å®šä¾èµ–æå‡ç­–ç•¥
package-manager: pnpm

# é…ç½®å…±äº«ä¾èµ–
shared-workspace-lockfile: true
```

### æ ¹ç›®å½• package.json

```json
{
  "name": "next-ai-build-workspace",
  "version": "1.0.0",
  "private": true,
  "description": "Next.js AI Build Workspace - Modular architecture for reusable components and tools",
  "packageManager": "pnpm@9.0.0",
  "engines": {
    "node": ">=18.0.0",
    "pnpm": ">=8.0.0"
  },
  "scripts": {
    "build": "pnpm -r build",
    "dev": "pnpm -r --parallel dev",
    "lint": "pnpm -r lint",
    "test": "pnpm -r test",
    "clean": "pnpm -r clean",
    "typecheck": "pnpm -r typecheck",
    "publish:all": "pnpm -r publish",
    "changeset": "changeset",
    "version-packages": "changeset version"
  },
  "devDependencies": {
    "@changesets/cli": "^2.27.1",
    "typescript": "^5.8.3",
    "turbo": "^2.0.0"
  },
  "pnpm": {
    "overrides": {
      "@types/react": "19.1.2",
      "@types/react-dom": "19.1.3"
    }
  }
}
```

## ğŸš€ å®Œæ•´çš„é¡¹ç›®åˆå§‹åŒ–å·¥ä½œæµ

### ä½¿ç”¨è„šæœ¬åˆ›å»ºæ–°ç½‘ç«™

```bash
# 1. ä½¿ç”¨æ¨¡æ¿åˆå§‹åŒ–
pnpm next-ai-scripts init --template=website apps/my-new-site

# 2. å®‰è£…ä¾èµ– (è‡ªåŠ¨æ‰§è¡Œ)
cd apps/my-new-site && pnpm install

# 3. é…ç½®éƒ¨ç½² (å¯é€‰)
pnpm next-ai-scripts setup-deployment --platform=vercel

# 4. å¯åŠ¨å¼€å‘
pnpm dev
```

### è„šæœ¬è‡ªåŠ¨ç”Ÿæˆå†…å®¹

- åŸºç¡€é¡¹ç›®ç»“æ„
- åˆé€‚çš„ `package.json` ä¾èµ–é…ç½®
- éƒ¨ç½²é…ç½®æ–‡ä»¶
- åŸºç¡€çš„é¡µé¢å’Œç»„ä»¶æ¨¡æ¿

## ğŸ“‹ è¿ç§»å®æ–½è®¡åˆ’

### é˜¶æ®µä¸€ï¼šåŸºç¡€è®¾æ–½æ­å»º (1-2å¤©)

1. **åˆ›å»º workspace ç»“æ„**
   ```bash
   # 1. é‡å‘½ååŸé¡¹ç›®
   mv next-ai-build next-ai-build-backup
   
   # 2. åˆ›å»ºæ–°çš„ workspace ç»“æ„
   mkdir next-ai-build-workspace
   cd next-ai-build-workspace
   
   # 3. åˆå§‹åŒ– workspace
   pnpm init
   
   # 4. åˆ›å»ºåŒ…ç›®å½•ç»“æ„
   mkdir -p packages/{lib,base-ui,third-ui,scripts,configs}
   mkdir -p apps/{main-website}
   mkdir -p shared/{types,configs,assets,constants,utils,hooks}
   ```

2. **é…ç½® workspace åŸºç¡€è®¾æ–½**
   - åˆ›å»º `pnpm-workspace.yaml`
   - é…ç½®æ ¹ç›®å½• `package.json`
   - è®¾ç½® TypeScript åŸºç¡€é…ç½®
   - é…ç½® ESLint å’Œ Prettier

### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŒ…å¼€å‘ (3-5å¤©)

1. **å¼€å‘ `@next-ai-build/lib`**
   - æå–å’Œé‡æ„ `appConfig.ts`
   - ç§»æ¤ `utils.ts` å’Œç›¸å…³å·¥å…·å‡½æ•°
   - åˆ›å»ºç±»å‹å®šä¹‰
   - ç¼–å†™å•å…ƒæµ‹è¯•

2. **å¼€å‘ `@next-ai-build/base-ui`**
   - ç§»æ¤ shadcn/ui ç»„ä»¶
   - é‡æ„å¸ƒå±€ç»„ä»¶
   - ä¼˜åŒ–æ ·å¼ç³»ç»Ÿ
   - åˆ›å»º Storybook æ–‡æ¡£

### é˜¶æ®µä¸‰ï¼šä¸“ç”¨åŒ…å¼€å‘ (2-3å¤©)

1. **å¼€å‘ `@next-ai-build/third-ui`**
   - é‡æ„ Clerk ç»„ä»¶
   - é‡æ„ Fumadocs ç»„ä»¶
   - å°è£…åˆ†æå·¥å…·ç»„ä»¶

2. **å¼€å‘ `@next-ai-build/scripts`**
   - é‡æ„ç°æœ‰è„šæœ¬
   - åˆ›å»º CLI å·¥å…·
   - æ·»åŠ æ¨¡æ¿ç³»ç»Ÿ

### é˜¶æ®µå››ï¼šé…ç½®åŒ…å’Œç½‘ç«™é‡æ„ (2-3å¤©)

1. **å¼€å‘ `@next-ai-build/configs`**
   - åˆ›å»ºé…ç½®æ¨¡æ¿
   - è®¾ç½®æœ€ä½³å®è·µé…ç½®

2. **é‡æ„ä¸»ç½‘ç«™**
   - è¿ç§»å†…å®¹åˆ°æ–°ç»“æ„
   - é›†æˆå„ä¸ªåŒ…
   - æµ‹è¯•å®Œæ•´åŠŸèƒ½

### é˜¶æ®µäº”ï¼šæµ‹è¯•å’Œå‘å¸ƒ (1-2å¤©)

1. **å…¨é¢æµ‹è¯•**
   - å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - ç«¯åˆ°ç«¯æµ‹è¯•

2. **æ–‡æ¡£ç¼–å†™**
   - å„åŒ…çš„ README
   - ä½¿ç”¨æŒ‡å—
   - è¿ç§»æŒ‡å—

3. **å‘å¸ƒå‡†å¤‡**
   - ç‰ˆæœ¬ç®¡ç†
   - å‘å¸ƒæµç¨‹
   - CI/CD é…ç½®

## ğŸ”§ å…³é”®æŠ€æœ¯ç»†èŠ‚

### ä¾èµ–ç®¡ç†ç­–ç•¥

```json
// æ¯ä¸ªåŒ…çš„ package.json ç¤ºä¾‹
{
  "name": "@next-ai-build/base-ui",
  "dependencies": {
    "@next-ai-build/lib": "workspace:*"
  },
  "peerDependencies": {
    "react": ">=18",
    "react-dom": ">=18",
    "next": ">=14"
  }
}
```

### æ„å»ºé…ç½®å…±äº«

```javascript
// packages/configs/src/next/next.config.template.ts
import { createNextConfig } from '@next-ai-build/configs/next'

export default createNextConfig({
  // é¡¹ç›®ç‰¹å®šé…ç½®
  experimental: {
    // ...
  }
})
```

### ç±»å‹å…±äº«æœºåˆ¶

```typescript
// shared/types/index.ts
export interface BaseAppConfig {
  baseUrl: string
  i18n: I18nConfig
  // ...
}

// packages/lib/src/types/index.ts
export * from '../../../shared/types'
```

## ğŸ“¦ å‘å¸ƒå’Œç‰ˆæœ¬ç®¡ç†

### ä½¿ç”¨ Changesets è¿›è¡Œç‰ˆæœ¬ç®¡ç†

```bash
# å®‰è£… changesets
pnpm add -DW @changesets/cli

# åˆå§‹åŒ–
pnpm changeset init

# åˆ›å»º changeset
pnpm changeset

# ç‰ˆæœ¬å‡çº§
pnpm changeset version

# å‘å¸ƒ
pnpm changeset publish
```

### CI/CD é…ç½®

```yaml
# .github/workflows/release.yml
name: Release
on:
  push:
    branches: [main]
jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install
      - run: pnpm build
      - run: pnpm test
      - run: pnpm changeset publish
```

## ğŸ¯ æ€»ç»“

è¿™ä¸ªä¼˜åŒ–åçš„æ¶æ„æ–¹æ¡ˆè§£å†³äº†ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

1. **scripts åŒ…çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**ï¼šä»å¼€å‘åˆ°å‘å¸ƒåˆ°ä½¿ç”¨çš„å®Œæ•´æµç¨‹
2. **å¤šåº”ç”¨æ”¯æŒ**ï¼šä½¿ç”¨ `apps/` ç›®å½•æ”¯æŒå¤šä¸ªç‹¬ç«‹éƒ¨ç½²çš„åº”ç”¨
3. **çµæ´»çš„å…±äº«èµ„æºç®¡ç†**ï¼š`shared/` ç›®å½•æ”¯æŒå„ç§å¤æ‚é…ç½®å’Œèµ„æºå…±äº«
4. **æ ‡å‡†åŒ–çš„å·¥ä½œæµ**ï¼šç»Ÿä¸€çš„åˆ›å»ºã€å¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒæµç¨‹

é€šè¿‡è¿™ä¸ªæ–¹æ¡ˆï¼Œå¯ä»¥å®ç°é«˜åº¦æ¨¡å—åŒ–çš„ä»£ç å¤ç”¨ï¼ŒåŒæ—¶ä¿æŒå„ä¸ªåŒ…çš„ç‹¬ç«‹æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æ¯ä¸ªåŒ…éƒ½å¯ä»¥ç‹¬ç«‹å‘å¸ƒå’Œç‰ˆæœ¬ç®¡ç†ï¼Œæ”¯æŒå¤šä¸ªç½‘ç«™é¡¹ç›®çš„å¿«é€Ÿåˆ›å»ºå’Œéƒ¨ç½²ã€‚